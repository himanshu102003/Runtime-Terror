# ☁️ Cloud Build Trigger Configuration for Runtime Terror

This document outlines the recommended Google Cloud Build trigger setup for the **Runtime Terror** project. This trigger automates an AI-powered test generation and code coverage reporting pipeline.

-----

## Trigger Details

  * **Trigger Name**: `runtime-terror-ci-cd`
  * **Description**: AI-powered test generation and coverage reporting pipeline.

-----

## Event Configuration

The trigger is configured to run on pushes to the specified repository and paths.

  * **Event**: Push to any branch
  * **Repository**: `github_Yashsadarangani_Runtime-Terror`
  * **Included Files Filter**:
      * `backend/**`
      * `tools/**`
      * `cloudbuild.yaml`

-----

## Build Substitutions

The following substitution variables are used in the `cloudbuild.yaml` configuration.

  * `_REPORT_DIR`: `backend/target/site/jacoco`
  * `_REPORTS_BUCKET_BASE`: `gs://runtime-terror-code/reports`
  * `_PROJECT_ID`: `runtime-terror-473009`

-----

## Prerequisites

Before setting up the trigger, ensure the following services are enabled and permissions are granted.

### Required GCP Services

  * Cloud Build API
  * Vertex AI API
  * Cloud Storage

### Required IAM Permissions

The Cloud Build service account requires the following roles:

  * **Vertex AI User**: `roles/aiplatform.user`
  * **Storage Object Admin**: `roles/storage.objectAdmin` (scoped to the `gs://runtime-terror-code` bucket)

-----

## ⚙️ Setup Instructions

### 1\. Create and Configure GCS Bucket

Execute the following commands to create the Google Cloud Storage bucket and grant the Cloud Build service account the necessary permissions.

```bash
# Create the GCS bucket
gsutil mb gs://runtime-terror-code

# Grant the Cloud Build service account permissions on the bucket
gsutil iam ch \
  serviceAccount:$(gcloud projects describe runtime-terror-473009 --format="value(projectNumber)")@cloudbuild.gserviceaccount.com:roles/storage.objectAdmin \
  gs://runtime-terror-code
```

### 2\. Create the Cloud Build Trigger

You can create the trigger manually via the Cloud Console or by using the following `gcloud` command.

```bash
gcloud builds triggers create github \
  --name="runtime-terror-ci-cd" \
  --description="AI-powered test generation and coverage reporting pipeline" \
  --repo-name="Runtime-Terror" \
  --repo-owner="Yashsadarangani" \
  --branch-pattern=".*" \
  --build-config="cloudbuild.yaml"
```